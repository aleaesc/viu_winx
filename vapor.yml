# Laravel Cloud/Vapor configuration
# This file prepares the app for production deploys.

name: viu-winx
environments:
    production:
        memory: 1024
        runtime: php-8.2
        cli:
            runtime: php-8.2
        build:
            - 'composer install --no-dev --prefer-dist'
            - 'php artisan config:cache'
            - 'php artisan route:cache'
            - 'php artisan view:cache'
        deploy:
            # Run migrations on each deploy to ensure schema and admin seeding
            - 'php artisan migrate --force'
        database: mysql
        # Uncomment and adjust if you add queues
        # queues:
        #   - connection: redis
        #     queue: default
        #     processes: 1
        # cache: redis
        # storage: s3

id: viu-winx
name: viu-winx
environments:
    production:
        memory: 1024
        cli-memory: 512
        runtime: 'php-8.2:al2023'
        build:
            - 'COMPOSER_MIRROR_PATH_REPOS=1 composer install --no-dev --optimize-autoloader'
            - 'php artisan config:cache'
            - 'php artisan route:cache'
            - 'php artisan view:cache'
        deploy:
            - 'php artisan migrate --force'
        database: viu-winx-db
        cache: viu-winx-cache
        warm: 10
        timeout: 60
